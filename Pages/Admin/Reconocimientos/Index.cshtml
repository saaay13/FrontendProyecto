@page
@model AdminReconocimientosIndexModel
@attribute [Microsoft.AspNetCore.Authorization.Authorize(Roles = "Administrador")]
@{
    ViewData["Title"] = "Reconocimientos";
}

<h2 class="mb-3">Reconocimientos</h2>

<div class="d-flex gap-2 mb-3">
    <a asp-page="./Create" class="btn btn-primary">Nuevo reconocimiento</a>
    <a asp-page="./CreateC" class="btn btn-outline-primary">Nuevo carnet</a>
</div>

<!-- ===================== CERTIFICADOS ===================== -->
<h4 class="mt-4 mb-2">Certificados</h4>
<div class="table-responsive">
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th>Id</th>
                <th>Código</th>
                <th>Voluntario</th>
                <th>ONG</th>
                <th>Proyecto</th>
                <th>Actividad</th>
                <th>Emisión</th>
                <th class="text-end" style="width:180px;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Certificados is null || !Model.Certificados.Any())
            {
                <tr>
                    <td colspan="8" class="text-center py-3">No hay certificados</td>
                </tr>
            }
            else
            {
                @foreach (var c in Model.Certificados)
                {
                    <tr>
                        <td>@c.IdCertificado</td>
                        <td class="small text-muted">@c.CodigoVerificacion</td>
                        <td class="fw-semibold">@c.UsuarioNombre</td>
                        <td>@c.OngNombre</td>
                        <td>@c.ProyectoNombre</td>
                        <td>@c.ActividadNombre</td>
                        <td class="text-nowrap">@c.FechaEmision.ToString("dd/MM/yyyy")</td>
                        <td class="text-end text-nowrap">
                            <a asp-page="./Edit" asp-route-id="@c.IdCertificado"
                               class="btn btn-sm btn-secondary me-1">Editar</a>
                            <form method="post"
                                  asp-page-handler="AnularCert"
                                  asp-route-id="@c.IdCertificado"
                                  class="d-inline"
                                  onsubmit="return confirm('¿Anular certificado?');">
                                @Html.AntiForgeryToken()
                                <button class="btn btn-sm btn-danger">Anular</button>
                            </form>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

<!-- ===================== CARNETS ===================== -->
<h4 class="mt-5 mb-2">Carnets</h4>
<div class="table-responsive">
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th>Id</th>
                <th>Nro/Código</th>
                <th>Voluntario</th>
                <th>ONG</th>
                <th>Emisión</th>
                <th>Vencimiento</th>
                <th>Estado</th>
                <th class="text-end" style="width:180px;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Carnets is null || !Model.Carnets.Any())
            {
                <tr>
                    <td colspan="8" class="text-center py-3">No hay carnets</td>
                </tr>
            }
            else
            {
                @foreach (var k in Model.Carnets)
                {
                    <tr>
                        <td>@k.IdCarnet</td>
                        <td class="small text-muted">@k.CodigoVerificacion</td>
                        <td class="fw-semibold">@k.UsuarioNombre</td>
                        <td>@k.OngNombre</td>
                        <td class="text-nowrap">@k.FechaEmision.ToString("dd/MM/yyyy")</td>
                        <td class="text-nowrap">@k.FechaVencimiento.ToString("dd/MM/yyyy")</td>
                        <td>
                            @{
                                var est = k.EstadoInscripcion?.ToString() ?? "";
                                var (badgeClass, badgeText) = est switch
                                {
                                    "Activo" => ("text-success", "Activo"),
                                    "Suspendido" => ("text-danger", "Suspendido"),
                                    "Vencido" => ("text-danger", "Vencido"),
                                    _ => ("text-muted", est)
                                };
                            }
                            <span class="@badgeClass">@badgeText</span>
                        </td>
                        <td class="text-end text-nowrap">
                            <a asp-page="./EditC" asp-route-id="@k.IdCarnet"
                               class="btn btn-sm btn-secondary me-1">Editar</a>
                            <form method="post"
                                  asp-page-handler="AnularCarnet"
                                  asp-route-id="@k.IdCarnet"
                                  class="d-inline"
                                  onsubmit="return confirm('¿Eliminar carnet?');">
                                @Html.AntiForgeryToken()
                                <button class="btn btn-sm btn-danger">Eliminar</button>
                            </form>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

<!-- (Opcional) Sección de emisión simple como nota -->
<div class="mt-5 text-muted">
    ¿Necesitas emitir un certificado o carnet? Usa los botones de arriba.
</div>
