@page
@model FrontendProyecto.Pages.Actividades.IndexModel

@{
    ViewData["Title"] = "Actividades";
}

<h2 class="mb-3">Actividades</h2>

@if (Model.Lista is null || Model.Lista.Count == 0)
{
    <div class="text-center text-muted py-5">
        <img src="~/img/actividades/empty.png"
             alt="Sin actividades"
             style="max-width:220px;opacity:.8" />
        <div class="mt-3">No hay actividades registradas</div>
    </div>
}
else
{
    <div class="row g-3">
        @foreach (var a in Model.Lista)
        {
            var est = a.EstadoActividad?.ToString() ?? "";
            var (badgeCls, badgeTxt) = est switch
            {
                "EnCurso" => ("bg-success", "En curso"),
                "Planificada" => ("bg-primary", "Planificada"),
                "Finalizada" => ("bg-secondary", "Finalizada"),
                "Cancelada" => ("bg-danger", "Cancelada"),
                _ => ("bg-dark", est)
            };

            <div class="col-12 col-md-6 col-lg-4">
                <div class="card h-100 shadow-sm border-0">
                    <!-- Imagen relacionada a la actividad -->
                    @{
                        var imgSrc = Url.Content($"~/img/actividades/act-{a.IdActividad}.jpg");
                        var fallback = Url.Content("~/img/actividades/default-actividad.jpg");
                    }
                    <img src="@imgSrc"
                         onerror="this.onerror=null;this.src='@fallback';"
                         alt="@a.NombreActividad"
                         class="card-img-top object-fit-cover" />


                    <div class="card-body d-flex flex-column">
                        <!-- Estado -->
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <span class="badge @badgeCls">@badgeTxt</span>
                            <span class="text-muted small">
                                @a.FechaActividad.ToString("dd/MM/yyyy")
                            </span>
                        </div>

                        <!-- Título + proyecto -->
                        <h5 class="card-title mb-1">@a.NombreActividad</h5>
                        <div class="text-muted small mb-2">
                            <i class="bi bi-briefcase me-1"></i>@a.NombreProyecto
                        </div>

                        <!-- Detalles -->
                        <div class="d-flex flex-wrap gap-2 small mb-3">
                            <span class="badge rounded-pill bg-primary-subtle text-primary border">
                                <i class="bi bi-clock me-1"></i>@a.HoraInicio.ToString(@"hh\:mm")–@a.HoraFin.ToString(@"hh\:mm")
                            </span>
                            <span class="badge rounded-pill bg-info-subtle text-info border">
                                <i class="bi bi-geo-alt me-1"></i>@a.Lugar
                            </span>
                            <span class="badge rounded-pill bg-warning-subtle text-dark border">
                                <i class="bi bi-people me-1"></i>Cupo: @a.CupoMaximo
                            </span>

                        </div>

                        <!-- Acción -->
                        <div class="mt-auto text-end">
                            <a asp-page="/Admin/Actividades/Inscribir"
                               asp-route-idActividad="@a.IdActividad"
                               class="btn btn-primary btn-sm">
                                Inscribirme
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}
